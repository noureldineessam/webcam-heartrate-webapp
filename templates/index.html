<!-- 
    • This Web APP is connected with a JS file for the heavey calculation.
    • Video is displyed directly from the camera stream.
    • Canvas with the ROI rectangle is hidden, to display it, get the canvas tag by searching ROI and delete the display:none.
    • Change the interval between datapoints by changing it from the JS file (first line).
    • Plotting codes are in this file, search Plotting.
    
    Table of Content
    1.0 #Head
        1.1 #Styles
    2.0 #Video Container HTML
        2.1 #Canvas ROI Debugging
    3.0 #Script
        3.1 #Setting Constraints
        3.2 #Camera Buttons Handlers
        3.3 #Browsers Media APIs
        3.4 #Start Live Stream  ----(Main call)
        3.5 #Plotting
 -->


<!DOCTYPE html>
<html lang="en">

<!------------------------------------------------->
<!------------------ 1.0 #Head -------------------->
<!------------------------------------------------->
<head>
    <title>Camera Test</title>
    <meta http-equiv='cache-control' content='max-age=0, public'/> 
    <meta http-equiv='expires' content='0'/>
    <meta http-equiv='pragma' content='no-cache'/> 
    <meta http-equiv='cleartype' content='on'> 
    <meta charset="utf-8"/> 
    <meta name='apple-mobile-web-app-capable' content='yes'>
    <meta name='mobile-web-app-capable' content='yes'>
    <meta name='HandheldFriendly' content='True'>
    <meta name='MobileOptimized' content='320'>
    <meta name='apple-mobile-web-app-status-bar-style' content='black'>
    <script type="text/javascript" src="{{ url_for('static', filename='jquery.js') }}"></script>
    <!-- <script src="jquery.js"></script> -->
    <script type= "text/javascript" src="{{ url_for('static', filename='dataProcessing.js') }}"></script>
    <script src="{{ url_for('static', filename='plotly-latest.min.js') }}"></script>
    <!-- <link rel="stylesheets" href="{{ url_for('static', filename='styles.min.css') }}"> -->

<!------------------------------------------------->
<!------------------ 1.1 #Styles ------------------>
<!------------------------------------------------->
    <style>
        .fa{
        display:inline-block;
        font:normal normal normal 14px/1 FontAwesome;
        font-size:inherit;
        text-rendering:auto;
        -webkit-font-smoothing:antialiased;
        }
        .camTestContainer button.w3-button, .camTestContainer button.w3-button * {
        color: #fff!important;
        }   
        .page-section, .ad-section:not(.ad-panel){
        overflow: hidden;
        position: relative;
        margin: auto;
        margin-bottom: 10px;
        -webkit-box-shadow: 0 2px 6px rgb(0 0 0 / 20%);
        -moz-box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        box-shadow: 0 2px 6px rgb(0 0 0 / 20%);
        max-width: 1240px;
        width: calc(100% - 20px);
        background-color: rgba(255,255,255,0.93);
        }
        .camTestContainer {
        margin-left: -10px;
        margin-right: -10px;
        margin-top: -10px;
        position: relative;
        }
        .camTestContainer>.w3-row.w3-container.resultC {
        position: relative;
        }
        .w3-padding-0, .w3-container {
        padding: 0!important;
        }
        .w3-container, .w3-panel {
        padding: .01em 16px;
        }
        .loading-tmp{z-index:999}.flip{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.blur{-webkit-filter:blur(3px);-moz-filter:blur(3px);-o-filter:blur(3px);-ms-filter:blur(3px);filter:blur(3px)}.brightness{-webkit-filter:brightness(5);-moz-filter:brightness(5);-o-filter:brightness(5);-ms-filter:brightness(5);filter:brightness(5)}.contrast{-webkit-filter:contrast(8);-moz-filter:contrast(8);-o-filter:contrast(8);-ms-filter:contrast(8);filter:contrast(8)}.hue-rotate{-webkit-filter:hue-rotate(90deg);-moz-filter:hue-rotate(90deg);-o-filter:hue-rotate(90deg);-ms-filter:hue-rotate(90deg);filter:hue-rotate(90deg)}.hue-rotate2{-webkit-filter:hue-rotate(180deg);-moz-filter:hue-rotate(180deg);-o-filter:hue-rotate(180deg);-ms-filter:hue-rotate(180deg);filter:hue-rotate(180deg)}.hue-rotate3{-webkit-filter:hue-rotate(270deg);-moz-filter:hue-rotate(270deg);-o-filter:hue-rotate(270deg);-ms-filter:hue-rotate(270deg);filter:hue-rotate(270deg)}.saturate{-webkit-filter:saturate(10);-moz-filter:saturate(10);-o-filter:saturate(10);-ms-filter:saturate(10);filter:saturate(10)}.grayscale{-webkit-filter:grayscale(1);-moz-filter:grayscale(1);-o-filter:grayscale(1);-ms-filter:grayscale(1);filter:grayscale(1)}.sepia{-webkit-filter:sepia(1);-moz-filter:sepia(1);-o-filter:sepia(1);-ms-filter:sepia(1);filter:sepia(1)}.invert{-webkit-filter:invert(1);-moz-filter:invert(1);-o-filter:invert(1);-ms-filter:invert(1);filter:invert(1)}.btnC>button{padding-top:10px}.btnC>button>i.fa{font-size:20px}.fa-play-circle:before{content:'\f144'}.fa-switch:before{content:'\f021'}.fa-flip:before{content:'\f0ec'}.fa-filter:before{content:'\f0b0'}.fa-capture:before{content:'\f030'}.fa-edit:before{content:'\f040'}.fa-download:before{content:'\f019'}.fa-error:before{content:'\f071'}.hideEl{display:none!important}.camTestContainer{margin-left:-10px;margin-right:-10px;margin-top:-10px;position:relative}.camTestContainer>.w3-row.w3-container.resultC{position:relative}.camTestContainer>.w3-row.w3-container.resultC>.w3-col::after{content:'';position:absolute;width:100%;height:calc(100% - 7px);top:0;left:0;background-color:#000;z-index:0}.camTestContainer button.w3-button{position:absolute;height:50px;width:50px;z-index:99;outline:0}.camTestContainer button.w3-button span{display:none!important}.camTestContainer button.w3-button,.camTestContainer button.w3-button *{color:#fff!important}.camTestContainer video#video{max-width:100%;min-width:100%;height:auto;z-index:2;position:sticky}.camTestContainer:not(.ok) video#video{background-color:#000;background-image:url('https://dkbg1jftzfsd2.cloudfront.net/image/arrow-up.gif');background-repeat:no-repeat;background-size:30px;background-position:center calc(50% + 45px)}.camTestContainer:not(.ok):after{content:'Click Play icon above for starting the camera';position:absolute;top:calc(50% + 55px);color:#fff;width:100%;text-align:center;z-index:98}@media(max-width:1000px){.camTestContainer:not(.ok):after{font-size:13px}}@media(max-width:320px){.camTestContainer:not(.ok):after{font-size:11px}}.camTestContainer img#img-review{height:80px;width:auto;position:absolute;left:20px;top:10px;z-index:99}.camTestContainer .btnC{background-color:rgba(0,0,0,0.4);width:100%;height:100px;bottom:7px!important;left:0;position:absolute;z-index:98}.camTestContainer .resultOK.text{position:absolute;left:17.5px;top:50px;height:50px;width:auto;color:#fff!important;z-index:99}.camTestContainer button.w3-button#startBtn .fa-play-circle{font-size:64px!important}.camTestContainer button.w3-button#startBtn{line-height:112px;border:none!important}.camTestContainer button.w3-button#capture:after{content:'';width:42px;height:41px;display:block;position:absolute;background:#fff;left:3px;top:4px;border:1px solid #000;border-radius:50%}.camTestContainer:before{content:'';width:100%;height:90px;display:block;position:absolute;background-color:rgba(0,0,0,0.4);bottom:0;left:0;z-index:98;top:0}.camTestContainer video#video{max-height:calc(100vh - 60px)}@media(max-width:1000px){.camTestContainer video#video{max-height:calc(100vh - 125px)}}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-heart:before{content:'\f004'}.fa-circle:before{content:'\f111';font-size:10px;vertical-align:middle}.fa-file-pdf:before{content:'\f1c1'}.fa-file-archive:before{content:'\f1c6'}.fa-file-image:before{content:'\f1c5'}.fa-tools:before{content:'\f0ad'}.fa-sync:before{content:'\f021'}.fa-tag:before{content:'\f02b'}.fa-lock:before{content:'\f023';font-size:22px}.fa-mail:before{content:'\f0e0'}.fa-arrows:before{content:'\f047'}.fa-crop:before{content:'\f125'}.fa-rotate-left:before{content:'\f0e2'}.fa-rotate-right:before{content:'\f01e'}.fa-search-plus:before{content:'\f00e'}.fa-search-minus:before{content:'\f010'}.fa-paypal:before{content:'\f1ed'}.fa-user:before{content:'\f007'}.fa-map-marker:before{content:'\f041'}.fa-paper-plane:before{content:'\f1d8'}.fa-reddit:before{content:'\f1a1'}.fa-linkedin:before{content:'\f0e1'}.fa-google:before{content:'\f1a0'}.fa-twitter:before{content:'\f099'}.fa-facebook:before{content:'\f09a'}.fa-question-circle:before{content:'\f059'}.fa-bars:before{content:'\f0c9';font-size:16px}.fa-check-circle:before{content:'\f058'}.fa-photo:before{content:'\f03e'}.fa-close:before{content:'\f00d';font-size:16px}.fa-cog:before{content:'\f013'}.fa-arrow-up:before{content:'\f106'}.fa-spin{-webkit-animation:fa-spin 5s linear infinite;animation:fa-spin 5s linear infinite}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@font-face{font-family:'FontAwesome';src:local('FontAwesome'),url(https://dkbg1jftzfsd2.cloudfront.net/fonts/fontawesome-webfont.eot?v=4.7.0);src:local('FontAwesome'),url(https://dkbg1jftzfsd2.cloudfront.net/fonts/fontawesome-webfont.eot?#iefix&amp;v=4.7.0) format('embedded-opentype'),url(https://dkbg1jftzfsd2.cloudfront.net/fonts/fontawesome-webfont.woff2?v=4.7.0) format('woff2'),url(https://dkbg1jftzfsd2.cloudfront.net/fonts/fontawesome-webfont.woff?v=4.7.0) format('woff'),url(https://dkbg1jftzfsd2.cloudfront.net/fonts/Font-awesome/fontawesome-webfont.ttf?v=4.7.0) format('truetype'),url(https://dkbg1jftzfsd2.cloudfront.net/fonts/fontawesome-webfont.svg?v=4.7.0#fontawesomeregular) format('svg');font-display:swap}html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section{display:block}summary{display:list-item}audio,canvas,progress,video{display:inline-block}progress{vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:0;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}figure{margin:1em 40px}img{border-style:none}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea,optgroup{font:inherit;margin:0}optgroup{font-weight:bold}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}legend{color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}h1{font-size:36px}h2{font-size:30px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}.w3-serif{font-family:serif}h1,h2,h3,h4,h5,h6{font-family:"Segoe UI",Arial,sans-serif;font-weight:400;margin:10px 0}.w3-wide{letter-spacing:4px}hr{border:0;border-top:1px solid #eee;margin:20px 0}.w3-image{max-width:100%;height:auto}img{vertical-align:middle}a{color:inherit}.w3-table,.w3-table-all{border-collapse:collapse;border-spacing:0;width:100%;display:table}.w3-table-all{border:1px solid #ccc}.w3-bordered tr,.w3-table-all tr{border-bottom:1px solid #ddd}.w3-striped tbody tr:nth-child(even){background-color:#f1f1f1}.w3-table-all tr:nth-child(odd){background-color:#fff}.w3-table-all tr:nth-child(even){background-color:#f1f1f1}.w3-hoverable tbody tr:hover,.w3-ul.w3-hoverable li:hover{background-color:#ccc}.w3-centered tr th,.w3-centered tr td{text-align:center}.w3-table td,.w3-table th,.w3-table-all td,.w3-table-all th{padding:8px 8px;display:table-cell;text-align:left;vertical-align:top}.w3-table th:first-child,.w3-table td:first-child,.w3-table-all th:first-child,.w3-table-all td:first-child{padding-left:16px}.w3-btn,.w3-button{border:0;display:inline-block;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:inherit;background-color:inherit;text-align:center;cursor:pointer;white-space:nowrap}.w3-btn:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}.w3-btn,.w3-button{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.w3-disabled,.w3-btn:disabled,.w3-button:disabled{cursor:not-allowed;opacity:.3}.w3-disabled *,:disabled *{pointer-events:none}.w3-btn.w3-disabled:hover,.w3-btn:disabled:hover{box-shadow:none}.w3-badge,.w3-tag{background-color:#000;color:#fff;display:inline-block;padding-left:8px;padding-right:8px;text-align:center}.w3-badge{border-radius:50%}.w3-ul{list-style-type:none;padding:0;margin:0}.w3-ul li{padding:8px 16px;border-bottom:1px solid #ddd}.w3-ul li:last-child{border-bottom:0}.w3-tooltip,.w3-display-container{position:relative}.w3-tooltip .w3-text{display:none}.w3-tooltip:hover .w3-text{display:inline-block}.w3-ripple:active{opacity:.5}.w3-ripple{transition:opacity 0s}.w3-input{padding:8px;display:block;border:0;border-bottom:1px solid #ccc;width:100%}.w3-select{padding:9px 0;width:100%;border:0;border-bottom:1px solid #ccc}.w3-dropdown-click,.w3-dropdown-hover{position:relative;display:inline-block;cursor:pointer}.w3-dropdown-hover:hover .w3-dropdown-content{display:block}.w3-dropdown-hover:first-child,.w3-dropdown-click:hover{background-color:#ccc;color:#000}.w3-dropdown-hover:hover>.w3-button:first-child,.w3-dropdown-click:hover>.w3-button:first-child{background-color:#ccc;color:#000}.w3-dropdown-content{cursor:auto;color:#000;background-color:#fff;display:none;position:absolute;min-width:160px;margin:0;padding:0;z-index:1}.w3-check,.w3-radio{width:24px;height:24px;position:relative;top:6px}.w3-sidebar{height:100%;width:200px;background-color:#fff;position:fixed!important;z-index:1;overflow:auto}.w3-bar-block .w3-dropdown-hover,.w3-bar-block .w3-dropdown-click{width:100%}.w3-bar-block .w3-dropdown-hover .w3-dropdown-content,.w3-bar-block .w3-dropdown-click .w3-dropdown-content{min-width:100%}.w3-bar-block .w3-dropdown-hover .w3-button,.w3-bar-block .w3-dropdown-click .w3-button{width:100%;text-align:left;padding:8px 16px}.w3-main,#main{transition:margin-left .4s}.w3-modal{z-index:3;display:none;padding-top:100px;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,0.4)}.w3-modal-content{margin:auto;background-color:#fff;position:relative;padding:0;outline:0;width:600px}.w3-bar{width:100%;overflow:hidden}.w3-center .w3-bar{display:inline-block;width:auto}.w3-bar .w3-bar-item{padding:8px 16px;float:left;width:auto;border:0;display:block;outline:0}.w3-bar .w3-dropdown-hover,.w3-bar .w3-dropdown-click{position:static;float:left}.w3-bar .w3-button{white-space:normal}.w3-bar-block .w3-bar-item{width:100%;display:block;padding:8px 16px;text-align:left;border:0;white-space:normal;float:none;outline:0}.w3-bar-block.w3-center .w3-bar-item{text-align:center}.w3-block{display:block;width:100%}.w3-responsive{display:block;overflow-x:auto}.w3-container:after,.w3-container:before,.w3-panel:after,.w3-panel:before,.w3-row:after,.w3-row:before,.w3-row-padding:after,.w3-row-padding:before,.w3-cell-row:before,.w3-cell-row:after,.w3-clear:after,.w3-clear:before,.w3-bar:before,.w3-bar:after{content:"";display:table;clear:both}.w3-col,.w3-half,.w3-third,.w3-twothird,.w3-threequarter,.w3-quarter{float:left;width:100%}.w3-col.s1{width:8.33333%}.w3-col.s2{width:16.66666%}.w3-col.s3{width:24.99999%}.w3-col.s4{width:33.33333%}.w3-col.s5{width:41.66666%}.w3-col.s6{width:49.99999%}.w3-col.s7{width:58.33333%}.w3-col.s8{width:66.66666%}.w3-col.s9{width:74.99999%}.w3-col.s10{width:83.33333%}.w3-col.s11{width:91.66666%}.w3-col.s12{width:99.99999%}@media(min-width:601px){.w3-col.m1{width:8.33333%}.w3-col.m2{width:16.66666%}.w3-col.m3,.w3-quarter{width:24.99999%}.w3-col.m4,.w3-third{width:33.33333%}.w3-col.m5{width:41.66666%}.w3-col.m6,.w3-half{width:49.99999%}.w3-col.m7{width:58.33333%}.w3-col.m8,.w3-twothird{width:66.66666%}.w3-col.m9,.w3-threequarter{width:74.99999%}.w3-col.m10{width:83.33333%}.w3-col.m11{width:91.66666%}.w3-col.m12{width:99.99999%}}@media(min-width:993px){.w3-col.l1{width:8.33333%}.w3-col.l2{width:16.66666%}.w3-col.l3{width:24.99999%}.w3-col.l4{width:33.33333%}.w3-col.l5{width:41.66666%}.w3-col.l6{width:49.99999%}.w3-col.l7{width:58.33333%}.w3-col.l8{width:66.66666%}.w3-col.l9{width:74.99999%}.w3-col.l10{width:83.33333%}.w3-col.l11{width:91.66666%}.w3-col.l12{width:99.99999%}}.w3-rest{overflow:hidden}.w3-stretch{margin-left:-16px;margin-right:-16px}.w3-content,.w3-auto{margin-left:auto;margin-right:auto}.w3-content{max-width:980px}.w3-auto{max-width:1140px}.w3-cell-row{display:table;width:100%}.w3-cell{display:table-cell}.w3-cell-top{vertical-align:top}.w3-cell-middle{vertical-align:middle}.w3-cell-bottom{vertical-align:bottom}.w3-hide{display:none!important}.w3-show-block,.w3-show{display:block!important}.w3-show-inline-block{display:inline-block!important}@media(max-width:1205px){.w3-auto{max-width:95%}}@media(max-width:600px){.w3-modal-content{margin:0 10px;width:auto!important}.w3-modal{padding-top:30px}.w3-dropdown-hover.w3-mobile .w3-dropdown-content,.w3-dropdown-click.w3-mobile .w3-dropdown-content{position:relative}.w3-hide-small{display:none!important}.w3-mobile{display:block;width:100%!important}.w3-bar-item.w3-mobile,.w3-dropdown-hover.w3-mobile,.w3-dropdown-click.w3-mobile{text-align:center}.w3-dropdown-hover.w3-mobile,.w3-dropdown-hover.w3-mobile .w3-btn,.w3-dropdown-hover.w3-mobile .w3-button,.w3-dropdown-click.w3-mobile,.w3-dropdown-click.w3-mobile .w3-btn,.w3-dropdown-click.w3-mobile .w3-button{width:100%}}@media(max-width:768px){.w3-modal-content{width:500px}.w3-modal{padding-top:50px}}@media(min-width:993px){.w3-modal-content{width:900px}.w3-hide-large{display:none!important}.w3-sidebar.w3-collapse{display:block!important}}@media(max-width:992px) and (min-width:601px){.w3-hide-medium{display:none!important}}@media(max-width:992px){.w3-sidebar.w3-collapse{display:none}.w3-main{margin-left:0!important;margin-right:0!important}.w3-auto{max-width:100%}}.w3-top,.w3-bottom{position:fixed;width:100%;z-index:1}.w3-top{top:0}.w3-bottom{bottom:0}.w3-overlay{position:fixed;display:none;width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);z-index:2}.w3-display-topleft{position:absolute;left:0;top:0}.w3-display-topright{position:absolute;right:0;top:0}.w3-display-bottomleft{position:absolute;left:0;bottom:0}.w3-display-bottomright{position:absolute;right:0;bottom:0}.w3-display-middle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%)}.w3-display-left{position:absolute;top:50%;left:0;transform:translate(0%,-50%);-ms-transform:translate(-0%,-50%)}.w3-display-right{position:absolute;top:50%;right:0;transform:translate(0%,-50%);-ms-transform:translate(0%,-50%)}.w3-display-topmiddle{position:absolute;left:50%;top:0;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%)}.w3-display-bottommiddle{position:absolute;left:50%;bottom:0;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%)}.w3-display-container:hover .w3-display-hover{display:block}.w3-display-container:hover span.w3-display-hover{display:inline-block}.w3-display-hover{display:none}.w3-display-position{position:absolute}.w3-circle{border-radius:50%}.w3-round-small{border-radius:2px}.w3-round,.w3-round-medium{border-radius:4px}.w3-round-large{border-radius:8px}.w3-round-xlarge{border-radius:16px}.w3-round-xxlarge{border-radius:32px}.w3-row-padding,.w3-row-padding>.w3-half,.w3-row-padding>.w3-third,.w3-row-padding>.w3-twothird,.w3-row-padding>.w3-threequarter,.w3-row-padding>.w3-quarter,.w3-row-padding>.w3-col{padding:0 8px}.w3-container,.w3-panel{padding:.01em 16px}.w3-panel{margin-top:16px;margin-bottom:16px}.w3-code,.w3-codespan{font-family:Consolas,"courier new";font-size:16px}.w3-code{width:auto;background-color:#fff;padding:8px 12px;border-left:4px solid #4caf50;word-wrap:break-word}.w3-codespan{color:crimson;background-color:#f1f1f1;padding-left:4px;padding-right:4px;font-size:110%}.w3-card,.w3-card-2{box-shadow:0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)}.w3-card-4,.w3-hover-shadow:hover{box-shadow:0 4px 10px 0 rgba(0,0,0,0.2),0 4px 20px 0 rgba(0,0,0,0.19)}.w3-spin{animation:w3-spin 2s infinite linear}@keyframes w3-spin{0%{transform:rotate(0deg)}100%{transform:rotate(359deg)}}.w3-animate-fading{animation:fading 10s infinite}@keyframes fading{0%{opacity:0}50%{opacity:1}100%{opacity:0}}.w3-animate-opacity{animation:opac .8s}@keyframes opac{from{opacity:0}to{opacity:1}}.w3-animate-top{position:relative;animation:animatetop .4s}@keyframes animatetop{from{top:-300px;opacity:0}to{top:0;opacity:1}}.w3-animate-left{position:relative;animation:animateleft .4s}@keyframes animateleft{from{left:-300px;opacity:0}to{left:0;opacity:1}}.w3-animate-right{position:relative;animation:animateright .4s}@keyframes animateright{from{right:-300px;opacity:0}to{right:0;opacity:1}}.w3-animate-bottom{position:relative;animation:animatebottom .4s}@keyframes animatebottom{from{bottom:-300px;opacity:0}to{bottom:0;opacity:1}}.w3-animate-zoom{animation:animatezoom .6s}@keyframes animatezoom{from{transform:scale(0)}to{transform:scale(1)}}.w3-animate-input{transition:width .4s ease-in-out}.w3-animate-input:focus{width:100%!important}.w3-opacity,.w3-hover-opacity:hover{opacity:.60}.w3-opacity-off,.w3-hover-opacity-off:hover{opacity:1}.w3-opacity-max{opacity:.25}.w3-opacity-min{opacity:.75}.w3-greyscale-max,.w3-grayscale-max,.w3-hover-greyscale:hover,.w3-hover-grayscale:hover{filter:grayscale(100%)}.w3-greyscale,.w3-grayscale{filter:grayscale(75%)}.w3-greyscale-min,.w3-grayscale-min{filter:grayscale(50%)}.w3-sepia{filter:sepia(75%)}.w3-sepia-max,.w3-hover-sepia:hover{filter:sepia(100%)}.w3-sepia-min{filter:sepia(50%)}.w3-tiny{font-size:10px!important}.w3-small{font-size:12px!important}.w3-medium{font-size:15px!important}.w3-large{font-size:18px!important}.w3-xlarge{font-size:24px!important}.w3-xxlarge{font-size:36px!important}.w3-xxxlarge{font-size:48px!important}.w3-jumbo{font-size:64px!important}.w3-left-align{text-align:left!important}.w3-right-align{text-align:right!important}.w3-justify{text-align:justify!important}.w3-center{text-align:center!important}.w3-border-0{border:0!important}.w3-border{border:1px solid #ccc!important}.w3-border-top{border-top:1px solid #ccc!important}.w3-border-bottom{border-bottom:1px solid #ccc!important}.w3-border-left{border-left:1px solid #ccc!important}.w3-border-right{border-right:1px solid #ccc!important}.w3-topbar{border-top:6px solid #ccc!important}.w3-bottombar{border-bottom:6px solid #ccc!important}.w3-leftbar{border-left:6px solid #ccc!important}.w3-rightbar{border-right:6px solid #ccc!important}.w3-section,.w3-code{margin-top:16px!important;margin-bottom:16px!important}.w3-margin{margin:16px!important}.w3-margin-top{margin-top:16px!important}.w3-margin-bottom{margin-bottom:16px!important}.w3-margin-left{margin-left:16px!important}.w3-margin-right{margin-right:16px!important}.w3-padding-small{padding:4px 8px!important}.w3-padding{padding:8px 16px!important}.w3-padding-large{padding:12px 24px!important}.w3-padding-16{padding-top:16px!important;padding-bottom:16px!important}.w3-padding-24{padding-top:24px!important;padding-bottom:24px!important}.w3-padding-32{padding-top:32px!important;padding-bottom:32px!important}.w3-padding-48{padding-top:48px!important;padding-bottom:48px!important}.w3-padding-64{padding-top:64px!important;padding-bottom:64px!important}.w3-left{float:left!important}.w3-right{float:right!important}.w3-button:hover{color:#000!important;}.w3-transparent,.w3-hover-none:hover{background-color:transparent!important}.w3-hover-none:hover{box-shadow:none!important}html{position:relative;min-height:100vh}body{line-height:1.5;font-family:'Segoe UI','Helvetica Neue',Helvetica,Roboto,Oxygen,Ubuntu,Cantarell,'Fira Sans','Droid Sans',sans-serif!important;font-size:15px;color:#000}b,strong{font-weight:600!important}@media(min-width:600px){.w3-row.align-bottom{display:flex;align-items:flex-end}.w3-row.align-bottom button{margin:unset}}@media(max-width:599px){.w3-row.align-bottom button.w3-button,.w3-row.align-bottom a.w3-button{margin:10px 0}}.w3-select{height:42px;border:1px solid #ccc}.slider{height:14px;border-radius:5px;background:#d3d3d3;outline:0;opacity:.9}.step{display:none;margin:0!important;padding-top:0!important}.step1{display:inline;padding:0!important}.custom-combobox{position:relative!important;display:inline-block!important;width:100%!important}.w3-padding-0,.w3-container{padding:0!important}.w3-content{min-height:calc(100vh - 61px);max-width:unset}@media(max-width:420px){.w3-content{min-height:calc(100vh - 62px)}}.navPageName{font-size:15px!important;padding:12px 2px!important;margin:0!important}.w3-bar .w3-button{background-color:transparent}.headerLogo{padding:14px 25px 18px 16px!important;height:40px!important;width:40px!important;margin-top:0;background-size:40px;margin-right:5px;margin-left:5px;background-repeat:no-repeat;position:relative}.headerLogo>svg{width:40px;height:40px;top:0;left:0;position:absolute}.menuToogle{height:100%;margin:0;padding:0!important;display:flex!important;align-items:center;justify-content:center;width:41px!important;color:#1affff!important}.menuToogle.hide{color:#fff!important}.paypalBtn{margin-right:10px;margin-top:0!important}.donateBtn{font-size:12px;padding:2px 8px 2px 8px;border:1px solid transparent}.new-style-nav-bar{background:rgba(69,90,100,1);color:#fff;height:41px;line-height:41px}.new-style-donateBtn{border:1px solid #fff!important;background-color:transparent!important;color:#fff!important;line-height:18px}@media(min-width:768px){.margin-content-menu-open{margin-left:250px!important}}
    </style>
</head>

<body>
<!------------------------------------------------->
<!------------2.0 #Video Container HTML------------>
<!------------------------------------------------->
    <div class='page-section'> 
        <div class="camTestContainer"> 
            <div class="w3-row w3-container resultC"> 
                <div class="w3-col"> 
                    <button id="startBtn" class="w3-button" style="top: calc(50% - 50px);left: calc(50% - 50px);height: 100px;width: 100px;border: 1px solid #fff;border-radius: 50%;color: transparent !important;z-index: 99;background-color: transparent !important;content: none !important;text-align: center;vertical-align: middle;"> 
                        <i class="fa fa-play-circle"></i>
                    </button> 
                    <button id="switch" class="w3-button resultOK hideEl" style="right: 0;" disabled="disabled"> 
                        <i class="fa fa-switch"></i> 
                    </button> 
                    <button id="flip" class="w3-button resultOK hideEl" style="left: 0;" disabled="disabled">
                        <i class="fa fa-flip"></i> 
                    </button> 
                    <div class="w3-row w3-container btnC"> 
                        <button id="stop" class="w3-button resultOK hideEl" style="left: calc(50% - 25px);top: calc(50% - 25px);border-radius: 50%;text-align: center;vertical-align: middle;padding: unset;border: 1px solid #fff; background-color: red;" disabled="disabled"> 
                            Stop 
                        </button> 
                    </div>                     
                    <video id="video" muted="" autoplay="" playsinline="" width="1000px" height="1000px"></video> 
                    
                </div> 
            </div> 
        </div> 
        <div class='w3-container welcomeTag'> 
            <div class='w3-row'> 
                <div class='w3-container'> 
                </div> 
            </div> 
        </div> 
    </div>

<!------------------------------------------------->
<!----------2.1 #Canvas ROI Debugging-------------->
<!------------------------------------------------->
    <canvas id="outcanvas" width="1000px" height="1000px"></canvas> 
    <div class="wrapper">
        <div id="chart"></div>
        <button id="clickMe"> click me</button>
    </div>
</body>


<!------------------------------------------------->
<!-----------------3.0 #Script--------------------->
<!------------------------------------------------->
<script>

// ----------------------------------------------------------
// -------------------3.1 #Setting Constraints---------------
// ----------------------------------------------------------  
    var captureCam = function(){};
    const constraints = {
        video: { 
            facingMode: "environment",
            width: { 
                ideal: 99999999 
            },
            height: { 
                ideal: 9999999 
            },
            frameRate: { 
                ideal: 60,
                min: 10 
            }
        }
    },
    constraintsS = {
        video: {
            facingMode: "user",
            width: { 
                ideal: 99999 
            },
            height: { 
                ideal: 9999  
            },
            frameRate: { 
                ideal: 60,
                min: 10 
            }
        }
    };

// -----------------------------------------------------------
// ---------------3.2 #Camera Buttons Handlers----------------
// -----------------------------------------------------------  
    function beginCameraCapture(){
        $('#startBtn').attr('disabled', 'disabled');
        var isDefault = true;
        var video = document.querySelector('video');
        var localMediaStream = null;
        const switchCam = document.querySelector('#switch');
        const stopBtn = document.querySelector('#stop');
        const img = document.querySelector('#img-review');
        const canvas = document.createElement('canvas');
        const flipButton = document.querySelector('#flip');
        $(video).toggleClass('flip');
        time0 = Date.now();
                
    
        flip.onclick = video.onclick = function() {
            $(video).toggleClass('flip');
        };
    
        switchCam.onclick = video.onclick = function() {
            try{video.pause();localMediaStream.stop();}catch(e){}
            
            isDefault = !isDefault;
            if (isDefault){
                captureCam(constraints);
            } else {
                captureCam(constraintsS);
            }
        };

        stopBtn.onclick = video.onclick = function() {
            let btn = document.getElementById("stop");
            if(!video.paused){
                video.pause();
                stopBtn.style.backgroundColor = "green";
                btn.innerHTML="Resume"
            }
            else {
                video.play();
                stopBtn.style.backgroundColor = "red";
                btn.innerHTML="Stop"
            }
            

        };
       

        function handleSuccess(stream) {
            localMediaStream = stream;
            window.stream = stream; // only to make stream available to console
            video.srcObject = stream;
            $('.resolutionInfo').text("Detecting...");
            $('.resultOK').removeClass('hideEl');
            $('.camTestContainer').addClass('ok');
            $('#startBtn').hide();
            $('#stop').attr('disabled', false);
            $('#switch').attr('disabled', false);
            $(flip).attr('disabled', false);
        };
        
        function handleError(error) {
            alert('Your Camera Cant Works :(');
        };

// -----------------------------------------------------------
// -----------------3.3 #Browsers Media APIs------------------
// -----------------------------------------------------------  
        captureCam = function(config){
                try {
                    // monkeypatch getUserMedia
                    navigator.getUserMedia = (
                        navigator.getUserMedia ||
                        navigator.webkitGetUserMedia ||
                        navigator.mozGetUserMedia ||
                        navigator.msGetUserMedia
                    );
    
                    if (typeof navigator.mediaDevices.getUserMedia === 'undefined') {
                        navigator.getUserMedia(config, handleSuccess, handleError);
                    } else {
                        navigator.mediaDevices.getUserMedia(config).then(handleSuccess).catch(handleError);
                    }
                } catch (e) {
                    alert('getUserMedia threw exception :' + e);
                }			    	
        };
    };
    
// -----------------------------------------------------------
// ----------------3.4 #Start Live Stream---------------------
// -----------------------------------------------------------  
    startBtn.addEventListener('click', function() {
        video.muted = false;
        
        beginCameraCapture();
        captureCam(constraints);

// -----------------------------------------------------------
// ---------------------3.5 #Plotting-------------------------
// -----------------------------------------------------------
        let x=[]
        setTimeout(() => {
    


            x=data(1);
            // let xlen=[]
            // let yfinal= [];
            // for (let i = 0; i < x.length; i++) {
            //     xlen[i]=i;  
            //     // yfinal[i]=x[i];  
                
            // }

            Plotly.plot('chart',[{y:[x], type:'line'}]);

            // var dataxx = {
            // x: [xlen],
            // y: [x],
            // mode: 'lines',
            // type: 'scatter',
            // };
            // Plotly.plot('chart', dataxx);
            console.log("Firing");
            var cnt = 0;
            setInterval(function(){
                Plotly.extendTraces('chart',{y:[[data(1)]]}, [0]); //double array y is using single value
                cnt++;
            //     if(cnt > 1) {
            //         let cntstart= cnt-1;
            //         let start=449*cntstart;
            //         let end=450*cnt;
            //         Plotly.relayout('chart',{
            //             xaxis: {
            //                 range: [start,end]
            //             }
            //         });
            //     }
            // },500);

            if(cnt > 200) {
                Plotly.relayout('chart',{
                    xaxis: {
                        range: [cnt-200,cnt]
                    }
                });
            }
            },15);
        }, 10000);
    });
</script>


<!-- Alternative code -->
<!-- <script>window.onload=function(e){
    try{startScripts()}catch(e){}};
</script> 
<script>
    let canvas,contextOut,cOut,context,cTemp,contextTemp;
    let unprocessedData=[];
    let processedData=[];
    let unprocessedDataR=[];
    let unprocessedDataRtest=[];
    let processedDataR=[];
    let processedDataRtest=[];
    let averageR=[0,0];
    let average=[0,0];
    let r,g,b;
    let videoHeight, videoWidth;
    let interval=1;
    var time0= [];
    let time= []; 
    var sample =[];
    var lock =1;
    


    document.getElementById("clickMe").addEventListener("click",function(){
        let aa=0;
        setInterval(() => {
            
            // while (unprocessedDataRtest.length<250){
            //     console.log("while")
            //     averageR=0;
            //     for (let i=rRect[0];i<rRect[0]+rRect[2];i++)
            //     {
            //         for (let j=rRect[1];j<rRect[1]+rRect[3];j++)
            //         {
            //             averageR+=contextOut.getImageData(i, j, 1, 1).data[0];
            //         }
            //     }
            //     averageR/=rRect[2]*rRect[3];
            //     unprocessedDataRtest.push(averageR);
            //     unprocessedDataR.push([averageR,(Date.now()-1000)]);

            //     processedDataRtest= normalizeArray(unprocessedDataRtest,250);
            //     processedDataR = normalizeArray(unprocessedDataR,250);
            // }
            // console.log("out")
            
            cOut= document.getElementById("outcanvas");
            contextOut = cOut.getContext("2d");
            let video = document.getElementById("video"),
                videoObj = { "video": true },
                errBack = function(error) {
                    console.log("Video capture error: ", error.code); 
                };

            videoHeight= $(video).height();
            videoWidth=$(video).width();
            cOut.width=videoWidth;
            cOut.height=videoHeight;
            contextOut.drawImage(video, 0, 0, videoWidth, videoHeight);        
            let rectW=cOut.width/2-25;
            let rectH=(cOut.height/2-15)-50;
            let rRect=[rectW, rectH, 10, 10];
            averageR=0;
                for (let i=rRect[0];i<rRect[0]+rRect[2];i++)
                {
                    for (let j=rRect[1];j<rRect[1]+rRect[3];j++)
                    {
                        averageR+=contextOut.getImageData(i, j, 1, 1).data[0];
                    }
                }
                averageR/=rRect[2]*rRect[3];
                time.push((Date.now())-time0 );
                durationToUse=normalizeArray(time,250);

                unprocessedDataR.push(averageR);
                processedDataR = normalizeArray(unprocessedDataR,250);
                dataStream = unprocessedDataRtest;
                durationR=(durationToUse[durationToUse.length-1])-(durationToUse[0]);
                fps= processedDataR.length/(durationR/100);
                console.log("durationToUse1:"+ durationR);
                console.log("fps:"+ fps);



            // fetch('/compute', {
            //     method: "POST",
            //     headers: {
            //         Accept: "application/json",
            //         "Content-Type": "application/json"
            //     },
            //     body: JSON.stringify({
            //         datapoint: dataStream,
            //         duration: durationR
            //     })
            // }).then(data => {return data.json()})
            // .then(res => {console.log(res)})
        }, 0);
    });
    function takeSample(sample){
                    //lock the system
                    lock =0;
                    
                    //take a sample
                    //analyse the sample
                    if (lock==0)
                    console.log(sample);
                    //unlock
                    setTimeout(() => {
                        lock=1;
                    }, 200);
            }
    function normalizeArray(data, length)
    {
        let res = [];
        if (data.length<length)
            return data;
        for (let i=data.length-length;i<data.length;i++)
            res.push(data[i]);
        return res;        
    }
    function fft(data)
    {
        let k,j;
        let res=[];
        let len =data.length;
        for (k=0;k<len;k++)
        {
            res.push(0);
            for (j=0;j<len;j++)
            {
                res[k]+=data[j]*Math.cos(2*3.1415*k*j/len);
                // console.log(data[j][0]*Math.cos(2*3.1415*i*j/data.length));
                
            }
        }

        return res;
    }
</script> -->
</html>